<script type="text/babel">
  const { useMemo, useState } = React;

  const CALENDARIOS = {
    Cayenne: [
      { elem: "Preparación del terreno", ini: 1, fin: 1 },
      { elem: "Germinación", ini: 1, fin: 1 },
      { elem: "Emergencia", ini: 1, fin: 1 },
      { elem: "Des. tallo y ramificación", ini: 1, fin: 1 },
      { elem: "Fertilización", ini: 1, fin: 1 },
      { elem: "Brotes axilares", ini: 1, fin: 1 },
      { elem: "Desarrollo foliar", ini: 1, fin: 2 },
      { elem: "Control de malezas", ini: 1, fin: 2 },
      { elem: "Control de plagas", ini: 1, fin: 8 },
      { elem: "Emergencia de inflorescencia", ini: 1, fin: 2 },
      { elem: "Floración (oleadas)", ini: 1, fin: 7 },
      { elem: "Cuajado (oleadas)", ini: 2, fin: 7 },
      { elem: "Desarrollo del fruto", ini: 3, fin: 8 },
      { elem: "Cosecha (escalonada)", ini: 3, fin: 8 },
    ],
    Habanero: [
      { elem: "Preparación del terreno", ini: 1, fin: 1 },
      { elem: "Germinación", ini: 1, fin: 1 },
      { elem: "Emergencia", ini: 1, fin: 1 },
      { elem: "Des. tallo y ramificación", ini: 1, fin: 2 },
      { elem: "Fertilización", ini: 1, fin: 2 },
      { elem: "Brotes axilares", ini: 1, fin: 2 },
      { elem: "Desarrollo foliar", ini: 1, fin: 2 },
      { elem: "Control de malezas", ini: 1, fin: 2 },
      { elem: "Control de plagas", ini: 1, fin: 8 },
      { elem: "Emergencia de inflorescencia", ini: 2, fin: 3 },
      { elem: "Floración (oleadas)", ini: 2, fin: 7 },
      { elem: "Cuajado (oleadas)", ini: 2, fin: 7 },
      { elem: "Desarrollo del fruto", ini: 3, fin: 8 },
      { elem: "Cosecha (escalonada)", ini: 3, fin: 8 },
    ],
    Tabasco: [
      { elem: "Preparación del terreno", ini: 1, fin: 1 },
      { elem: "Germinación", ini: 1, fin: 1 },
      { elem: "Emergencia", ini: 1, fin: 1 },
      { elem: "Des. tallo y ramificación", ini: 1, fin: 3 },
      { elem: "Fertilización", ini: 1, fin: 3 },
      { elem: "Brotes axilares", ini: 2, fin: 3 },
      { elem: "Desarrollo foliar", ini: 1, fin: 3 },
      { elem: "Control de malezas", ini: 1, fin: 3 },
      { elem: "Control de plagas", ini: 1, fin: 9 },
      { elem: "Emergencia de inflorescencia", ini: 3, fin: 4 },
      { elem: "Floración (oleadas)", ini: 3, fin: 8 },
      { elem: "Cuajado (oleadas)", ini: 4, fin: 8 },
      { elem: "Desarrollo del fruto", ini: 5, fin: 9 },
      { elem: "Cosecha (escalonada)", ini: 5, fin: 9 },
    ],
  };

  const months = [1,2,3,4,5,6,7,8,9];

  function AppletCapsicum(){
    const [especie, setEspecie] = useState("Cayenne");
    const data = CALENDARIOS[especie];

    const grid = useMemo(()=>{
      return data.map(d => {
        const monthsActive = months.map(m => (m>=d.ini && m<=d.fin));
        return { ...d, monthsActive };
      });
    }, [data]);

    return (
      <div className="p-6 space-y-6">
        <header className="flex items-center justify-between">
          <h1 className="text-2xl font-semibold">Applet – Fenología y Riesgos por especie</h1>
          <div className="flex items-center gap-2">
            <label className="text-sm text-gray-600">Especie:</label>
            <select
              value={especie}
              onChange={(e)=>setEspecie(e.target.value)}
              className="border rounded-lg px-3 py-2 text-sm"
            >
              {Object.keys(CALENDARIOS).map(k=> (
                <option key={k} value={k}>{k}</option>
              ))}
            </select>
          </div>
        </header>

        <div className="overflow-auto border rounded-2xl">
          <table className="min-w-full text-sm">
            <thead>
              <tr className="bg-gray-50">
                <th className="text-left px-3 py-2 sticky left-0 bg-gray-50">Elemento expuesto</th>
                {months.map(m=> (
                  <th key={m} className="px-3 py-2 text-center border-l">M{m}</th>
                ))}
              </tr>
            </thead>
            <tbody>
              {grid.map((row,i)=> (
                <tr key={i} className={i%2 ? "bg-white" : "bg-gray-50/50"}>
                  <td className="px-3 py-2 sticky left-0 bg-inherit max-w-[260px]">{row.elem}</td>
                  {row.monthsActive.map((on, j)=> (
                    <td key={j} className={`h-9 border-l ${on ? "bg-emerald-200" : ""}`}></td>
                  ))}
                </tr>
              ))}
            </tbody>
          </table>
        </div>

        <p className="text-gray-600 text-sm">
          Mes 1 = 21-dic → 20-ene. Cambia la especie para ver su calendario.
        </p>
      </div>
    );
  }

  // Montar en el div#root
  const root = ReactDOM.createRoot(document.getElementById("root"));
  root.render(<AppletCapsicum />);
</script>

